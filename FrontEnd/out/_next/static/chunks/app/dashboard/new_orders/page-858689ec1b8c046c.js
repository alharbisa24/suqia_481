(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[732],{7998:(e,t,s)=>{Promise.resolve().then(s.bind(s,1534))},1534:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var a=s(5155),l=s(8173),r=s.n(l),c=s(7493),n=s(3100),i=s(8639),d=s(1354),o=s(7936),x=s(2115),h=s(2651),p=s(6046),m=s(209);function g(){(0,x.useEffect)(()=>{window.notyf=new m.zT({duration:5e3,position:{x:"left",y:"top"},types:[{type:"success",background:"green",icon:{className:"notyf__icon--success",tagName:"i"}},{type:"error",background:"#ff5e5e",icon:{className:"notyf__icon--error",tagName:"i"}}]})},[]);let e=(0,p.useRouter)(),[t,s]=(0,x.useState)([]),[l,g]=(0,x.useState)([]),[u,y]=(0,x.useState)(null),j=async()=>{try{let e=await h.A.get("".concat("http://localhost:2000","/new_orders"));s(e.data)}catch(t){var e;console.error("Error fetching orders:",(null===(e=t.response)||void 0===e?void 0:e.data)||t.message)}finally{}};(0,x.useEffect)(()=>{let e=localStorage.getItem("user");y(e?JSON.parse(e):null),j()},[]),(0,x.useEffect)(()=>{(null==u?void 0:u.id)&&("user"==u.rank&&e.push("/"),b())},[u]);let b=async()=>{try{let e="".concat("http://localhost:2000","/distributer_orders?distributer_id=").concat(u.id),t=await h.A.get(e);200===t.status&&g(t.data)}catch(e){console.error("Error fetching orders:",e)}},[f,N]=(0,x.useState)("new"),[v,w]=(0,x.useState)(null),[k,C]=(0,x.useState)(null),[_,S]=(0,x.useState)(!1),[z,A]=(0,x.useState)(null),[M,O]=(0,x.useState)(!1),[E,L]=(0,x.useState)(!1),[T,H]=(0,x.useState)(!1),W=(0,x.useRef)(null),I=(0,x.useRef)(null);(0,x.useEffect)(()=>(_&&P(),()=>R()),[_]);let P=async()=>{try{var e;(null===(e=W.current)||void 0===e?void 0:e.srcObject)&&W.current.srcObject.getTracks().forEach(e=>e.stop());let t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});W.current&&(W.current.srcObject=t)}catch(e){alert("الرجاء السماح بالوصول إلى الكاميرا")}},R=()=>{var e;(null===(e=W.current)||void 0===e?void 0:e.srcObject)&&W.current.srcObject.getTracks().forEach(e=>e.stop())},q=async e=>{if(O(!0),l.length>0){alert("لديك طلب مخصص لم يتم تسليمه بعد. الرجاء إكمال التسليم الحالي أولاً"),O(!1);return}try{let t=await fetch("".concat("http://localhost:2000","/assignOrder"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,distributer_id:null==u?void 0:u.id})});200===t.status?(O(!1),j(),b(),window.notyf.success("تم تعيين الطلب لك بنجاح !")):O(!1),500===t.status&&(window.notyf.error("عذرا ! الطلب استلمه سائق اخر ، يمكنك استلام طلب اخر."),j(),b())}catch(e){alert(e.message),O(!1)}},D=async e=>{L(!0);try{let t=await fetch("".concat("http://localhost:2000","/cancelDelivery"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,distributer_id:null==u?void 0:u.id})});200===t.status?(L(!1),j(),b()):(alert("حدث خطأ أثناء تعيين الطلب. الرجاء المحاولة مرة أخرى."),L(!1))}catch(e){alert(e.message),L(!1)}},B=async()=>{if(!k){alert("الرجاء التقاط صورة للتأكيد");return}try{let e=new FormData,t=await fetch(k).then(e=>e.blob());e.append("id",v._id),e.append("image",t,"".concat(v._id,".jpeg"));let s=await h.A.post("".concat("http://localhost:2000","/order_completed"),e,{headers:{"Content-Type":"multipart/form-data"}});200===s.status?(alert("تم تأكيد التسليم بنجاح!"),b(),j()):alert("فشل في تأكيد التسليم. الرجاء المحاولة مرة أخرى.")}catch(e){console.error("Error during delivery confirmation:",e),alert("حدث خطأ أثناء تأكيد التسليم. الرجاء المحاولة لاحقاً.")}finally{S(!1),C(null),R()}};return(0,a.jsxs)("div",{className:"flex flex-col min-h-screen bg-gray-100",children:[(0,a.jsxs)("div",{className:"fixed right-0 min-h-[600px] w-64 bg-gray-50 text-black shadow-lg flex flex-col m-5 mt-20 rounded-3xl p-6 transition-transform duration-300 ease-in-out transform ".concat(T?"translate-x-0 top-20":"translate-x-full top-10"," md:translate-x-0 z-50"),children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-center text-black mb-8",children:"لوحة تحكم السائقين"}),(0,a.jsxs)("nav",{className:"flex flex-col space-y-4",children:[(0,a.jsxs)(r(),{href:"/dashboard/home",className:"flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-200 transition text-black",children:[(0,a.jsx)(c.A,{className:"w-5 h-5 text-gray-700 m-2"})," ",(0,a.jsx)("span",{children:"الرئيسية"})]}),(0,a.jsxs)(r(),{href:"/dashboard/new_orders",className:"flex items-center space-x-3 p-3 rounded-lg bg-gray-200 transition text-black",children:[(0,a.jsx)(n.A,{className:"w-5 h-5 text-gray-700 m-2"})," ",(0,a.jsx)("span",{children:"الطلبات الجارية"})]}),(0,a.jsxs)(r(),{href:"/dashboard/orders",className:"flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-200 transition text-black",children:[(0,a.jsx)(i.A,{className:"w-5 h-5 text-gray-700 m-2"})," ",(0,a.jsx)("span",{children:"الطلبات المكتملة"})]}),(0,a.jsxs)("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),y(null),e.push("/login")},className:"flex items-center space-x-3 p-3 rounded-lg hover:bg-red-300 transition mt-auto text-black",children:[(0,a.jsx)(d.A,{className:"w-5 h-5 text-gray-700 m-2"})," ",(0,a.jsx)("span",{children:"تسجيل خروج"})]})]})]}),(0,a.jsxs)("div",{className:"flex-grow p-6 text-black relative z-10 transition-padding duration-300 ".concat("md:pr-80 "),children:[(0,a.jsx)("button",{className:" top-20 right-5 z-50 bg-gray-100 p-2 rounded-full  md:hidden",onClick:()=>H(!T),children:(0,a.jsx)(o.A,{className:"w-6 h-6 text-gray-700"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-right mb-8",children:"الطلبات الجارية"}),(0,a.jsxs)("div",{className:"relative flex flex-col my-12 bg-white rounded-3xl p-6 overflow-x-auto",children:[(0,a.jsx)("div",{className:"flex justify-end mb-4"}),(0,a.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,a.jsxs)("button",{className:"px-4 py-2 rounded-lg ".concat("new"===f?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),onClick:()=>N("new"),children:["الطلبات الجديدة (",t.length,")"]}),(0,a.jsxs)("button",{className:"px-4 py-2 rounded-lg ".concat("assigned"===f?"bg-sky-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),onClick:()=>N("assigned"),children:["الطلبات المخصصة (",l.length,")"]})]}),"new"===f&&(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full text-right text-sm md:text-base",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-50",children:[(0,a.jsx)("th",{className:"px-4 py-2",children:"رقم الطلب"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"الطلب"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"الشركة"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"الكمية"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"المبلغ"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"العنوان"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"المسجد"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"الإجراء"})]})}),(0,a.jsxs)("tbody",{children:[t.map((e,t)=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsxs)("td",{className:"px-4 py-3",children:["#",e.order_id]}),(0,a.jsxs)("td",{className:"px-4 py-3",children:["كرتون ماء ",e.selectedSize]}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.company}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.quantity}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[e.totalPrice,(0,a.jsx)("img",{className:"h-4 md:h-5 w-auto inline-block",src:"/images/Saudi_Riyal_Symbol.svg",alt:"ريال سعودي"})]})})}),(0,a.jsxs)("td",{className:"px-4 py-3",children:[e.city," - ",e.district," - ",e.street,(0,a.jsxs)("button",{onClick:()=>window.open("https://www.google.com/maps/dir/?api=1&destination=".concat(e.latitude,",").concat(e.longitude),"_blank"),className:"flex items-center justify-center px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:[(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 ml-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"الاتجاهات للموقع"]})]}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.mosque}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("button",{onClick:()=>q(e._id),className:"px-4 py-2 rounded-lg flex items-center justify-center ".concat(l.length>0?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-sky-500 text-white hover:bg-sky-600"),disabled:l.length>0||M,children:M?(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-2 text-white",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4l3-3-3-3v4a8 8 0 11-8 8z"})]}):l.length>0?"مشغول بتسليم طلب آخر":"تعيين لي"})})]},t)),0===t.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:"8",className:"px-4 py-6 text-center text-gray-500",children:"لا توجد طلبات جديدة"})})]})]})}),"assigned"===f&&(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full text-right text-sm md:text-base",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-50",children:[(0,a.jsx)("th",{className:"px-4 py-2",children:"رقم الطلب"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"الطلب"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"الشركة"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"الكمية"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"العنوان"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"الإجراء"})]})}),(0,a.jsxs)("tbody",{children:[l.map((e,t)=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsxs)("td",{className:"px-4 py-3",children:["#",e.order_id]}),(0,a.jsxs)("td",{className:"px-4 py-3",children:["كرتون ماء ",e.selectedSize]}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.company}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.quantity}),(0,a.jsxs)("td",{className:"px-4 py-3",children:[e.city," - ",e.district," - ",e.street]}),(0,a.jsxs)("td",{className:"px-4 py-3",children:[(0,a.jsx)("button",{onClick:()=>{w(e),S(!0)},className:"bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600",children:"تاكيد التسليم"}),(0,a.jsx)("br",{}),"  ",(0,a.jsx)("br",{}),(0,a.jsx)("button",{onClick:()=>{D(e._id)},className:"px-2 py-2  rounded-lg transition text-white ".concat(E?"bg-red-400 cursor-not-allowed":"bg-red-300 hover:bg-red-600"),disabled:E,children:E?(0,a.jsxs)("span",{className:"flex items-center justify-center",children:[(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-2 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]}),"جاري التحميل..."]}):"التنازل عن الطلب"})]})]},t)),0===l.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:"6",className:"px-4 py-6 text-center text-gray-500",children:"لا توجد طلبات مخصصة"})})]})]})})]})]}),z&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",onClick:()=>A(null),children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 max-w-3xl max-h-[90vh] relative",children:[(0,a.jsx)("img",{src:z,alt:"صورة التسليم المعينة",className:"max-w-full max-h-[80vh] object-contain"}),(0,a.jsx)("button",{className:"absolute top-4 left-4 text-gray-600 hover:text-gray-800 text-2xl",onClick:()=>A(null),children:"\xd7"})]})}),_&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-40",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md text-black",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-right mb-4",children:["تأكيد التسليم للطلب #",null==v?void 0:v.order_id]}),(0,a.jsxs)("div",{className:"relative aspect-video bg-gray-100 rounded-lg mb-4 overflow-hidden",children:[k?(0,a.jsx)("img",{src:k,alt:"معاينة صورة التسليم",className:"w-full h-full object-cover"}):(0,a.jsx)("video",{ref:W,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),(0,a.jsx)("canvas",{ref:I,className:"hidden"})]}),(0,a.jsx)("div",{className:"flex gap-2 justify-end",children:k?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:B,className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600",children:"تأكيد التسليم"}),(0,a.jsx)("button",{onClick:()=>{C(null),P()},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"إعادة التقاط"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>{let e=I.current,t=W.current;if(!e||!t)return;if(!t.videoWidth||!t.videoHeight){alert("الكاميرا ما عطت إشارة");return}e.width=t.videoWidth,e.height=t.videoHeight,e.getContext("2d").drawImage(t,0,0);let s=e.toDataURL("image/jpeg");console.log("Captured image:",s),C(s)},className:"px-4 py-2 bg-sky-500 text-white rounded-lg hover:bg-sky-600",children:"التقاط صورة"}),(0,a.jsx)("button",{onClick:()=>{S(!1),R()},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"إلغاء"})]})})]})})]})}s(1092)},7493:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(4057).A)("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]])},8639:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(4057).A)("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]])},1354:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(4057).A)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])},3100:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(4057).A)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[829,616,651,227,441,517,358],()=>t(7998)),_N_E=e.O()}]);