"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[643],{2643:(e,t,s)=>{s.r(t),s.d(t,{default:()=>i});var l=s(5155),a=s(2115),r=s(6046),c=s(2651),n=s(2818);function i(){let[e,t]=(0,a.useState)(""),[s,i]=(0,a.useState)(""),[d,x]=(0,a.useState)(""),[m,o]=(0,a.useState)(""),[h,u]=(0,a.useState)(!1),[p,f]=(0,a.useState)(!1),[b,g]=(0,a.useState)(""),[v,N]=(0,a.useState)(!1),j=(0,r.useRouter)(),w=(0,r.useSearchParams)(),y=e=>{let t=0,s={length:e.length>=8,hasSymbol:/[!@#$%^&*(),.?":{}|<>]/.test(e),hasNumber:/[0-9]/.test(e)};return s.length&&t++,s.hasSymbol&&t++,s.hasNumber&&t++,{strength:t,checks:s}};(0,a.useEffect)(()=>{let e=w.get("token");e?(o(e),k(e)):(f(!0),u(!1))},[w]);let k=async e=>{N(!0);try{let s=await c.A.post("".concat("http://localhost:2000","/checkToken"),{token:e});s.data&&s.data.valid?(u(!0),t(s.data.email||"")):(u(!1),g("رمز استعادة كلمة المرور غير صالح أو منتهي الصلاحية"))}catch(e){var s,l;u(!1),g((null===(l=e.response)||void 0===l?void 0:null===(s=l.data)||void 0===s?void 0:s.message)||"حدث خطأ أثناء التحقق من صلاحية الرمز")}finally{f(!0),N(!1)}},S=async t=>{if(t.preventDefault(),s!==d){g("كلمات المرور غير متطابقة");return}let{strength:l,checks:a}=y(s);if(!a.length){g("يجب أن تكون كلمة المرور 8 أحرف على الأقل");return}if(!a.hasSymbol){g("يجب أن تحتوي كلمة المرور على رمز واحد على الأقل");return}if(!a.hasNumber){g("يجب أن تحتوي كلمة المرور على رقم واحد على الأقل");return}N(!0);try{let t="".concat(n.env.NEXT_PUBLIC_API_URL,"/reset-password");await c.A.post(t,{email:e,password:s,token:m}),window.notyf.success("تم تغيير كلمة المرور بنجاح!"),setTimeout(()=>{j.push("/login")},2e3)}catch(e){var r,i;g((null===(i=e.response)||void 0===i?void 0:null===(r=i.data)||void 0===r?void 0:r.message)||"حدث خطأ أثناء تحديث كلمة المرور")}finally{N(!1)}};return p?(0,l.jsxs)("div",{className:"flex flex-col md:flex-row-reverse h-full",children:[(0,l.jsxs)("div",{className:"w-full md:w-1/2 flex flex-col justify-center items-center p-6 md:p-10 transition-all duration-500 bg-blue-900 text-white",children:[(0,l.jsx)("h2",{className:"text-xl md:text-2xl font-semibold text-center",children:h?"إنشاء كلمة مرور جديدة":"تذكرت كلمة المرور؟"}),(0,l.jsx)("a",{href:"/login",className:"mt-4 md:mt-6 px-4 py-2 md:px-5 md:py-2 border rounded-full text-sm md:text-base border-white text-white transition hover:bg-white hover:text-blue-500",children:"العودة لتسجيل الدخول"})]}),(0,l.jsx)("div",{className:"w-full md:w-1/2 flex flex-col justify-center p-4 md:p-12 text-right",children:h?(0,l.jsxs)("form",{onSubmit:S,className:"w-full max-w-md mx-auto",children:[(0,l.jsx)("h2",{className:"text-xl md:text-2xl font-semibold text-blue-500",children:"تعيين كلمة مرور جديدة"}),(0,l.jsx)("p",{className:"text-gray-600 mt-2 mb-4",children:"الرجاء إدخال كلمة المرور الجديدة"}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("input",{type:"password",placeholder:"كلمة المرور الجديدة",value:s,onChange:e=>i(e.target.value),className:"mt-3 p-3 w-full border rounded text-right text-sm md:text-base text-black",required:!0}),(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsx)("div",{className:"flex justify-between mb-1",children:(0,l.jsx)("div",{className:"text-xs text-gray-500",children:"قوة كلمة المرور"})}),(0,l.jsx)("div",{className:"flex space-x-1 rtl:space-x-reverse",children:[void 0,void 0,void 0].map((e,t)=>(0,l.jsx)("div",{className:"h-2 flex-1 rounded-full transition-all duration-300 ".concat(0===s.length?"bg-gray-200":t<y(s).strength?["bg-red-500","bg-yellow-500","bg-green-500"][y(s).strength-1]:"bg-gray-200")},t))})]}),(0,l.jsxs)("div",{className:"mt-2 text-xs space-y-1",children:[(0,l.jsxs)("div",{className:"flex items-center ".concat(s.length>=8?"text-green-500":"text-gray-400"),children:[(0,l.jsx)("span",{className:"ml-1",children:s.length>=8?"✓":"○"}),"8 أحرف على الأقل"]}),(0,l.jsxs)("div",{className:"flex items-center ".concat(/[!@#$%^&*(),.?":{}|<>]/.test(s)?"text-green-500":"text-gray-400"),children:[(0,l.jsx)("span",{className:"ml-1",children:/[!@#$%^&*(),.?":{}|<>]/.test(s)?"✓":"○"}),"رمز واحد على الأقل (مثل !@#$%)"]}),(0,l.jsxs)("div",{className:"flex items-center ".concat(/[0-9]/.test(s)?"text-green-500":"text-gray-400"),children:[(0,l.jsx)("span",{className:"ml-1",children:/[0-9]/.test(s)?"✓":"○"}),"رقم واحد على الأقل"]})]})]}),(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsx)("input",{type:"password",placeholder:"تأكيد كلمة المرور",value:d,onChange:e=>x(e.target.value),className:"mt-3 p-3 w-full border rounded text-right text-sm md:text-base text-black",required:!0})}),b&&(0,l.jsx)("p",{className:"text-red-500 text-sm mt-2",children:b}),(0,l.jsx)("button",{type:"submit",className:"mt-4 md:mt-5 px-4 py-2 md:px-5 md:py-3 w-full bg-blue-500 text-white rounded text-sm md:text-base transition hover:bg-blue-600 ".concat(v?"opacity-50 cursor-not-allowed":""),disabled:v,children:v?(0,l.jsxs)("span",{className:"flex items-center justify-center",children:[(0,l.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-2 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]}),"جاري التحميل..."]}):"حفظ كلمة المرور الجديدة"})]}):(0,l.jsxs)("form",{className:"w-full max-w-md mx-auto",children:[(0,l.jsx)("h2",{className:"text-xl md:text-2xl font-semibold text-blue-500",children:"استعادة كلمة المرور"}),m&&(0,l.jsx)("p",{className:"text-red-500 text-sm mt-2 mb-4",children:"رابط استعادة كلمة المرور غير صالح أو منتهي الصلاحية. الرجاء طلب رابط جديد."}),b&&(0,l.jsx)("p",{className:"text-red-500 text-sm mt-2",children:b}),(0,l.jsx)("a",{href:"/forgot-password",className:"mt-4 inline-block px-4 py-2 bg-blue-500 text-white rounded text-sm md:text-base hover:bg-blue-600",children:"طلب رابط جديد"})]})})]}):(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsxs)("svg",{className:"animate-spin h-12 w-12 mx-auto text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]}),(0,l.jsx)("p",{className:"mt-3 text-lg",children:"جاري التحقق من صلاحية الرابط..."})]})}}}]);